# 语义匹配评估工具

## 概述

该评估工具用于分析不同语义匹配模型的性能，计算AUC指标并找出最佳阈值。它专为处理语义匹配实验的结果而设计，可以评估多种模型的性能并提供可视化比较。

## 功能

- 加载实验结果数据并过滤有效样本
- 计算每个模型的ROC曲线和AUC值
- 找出每个模型的最佳阈值（基于Youden's J统计量）
- 计算精确率-召回率曲线和平均精确率
- 进行阈值敏感性分析，评估不同阈值对模型性能的影响
- 可视化ROC曲线、PR曲线和阈值敏感性曲线
- 将评估结果保存为CSV文件

## 使用方法

### 命令行参数

```bash
python semantic_matching_evaluator.py [--data-path DATA_PATH] [--output-dir OUTPUT_DIR]
```

参数说明：
- `--data-path`: 实验结果数据文件路径，默认为 "data/dataset1_exp_1742352405.csv"
- `--output-dir`: 输出目录，用于保存图表和结果，默认为数据文件所在目录

### 示例

```bash
# 使用默认参数
python src/runner_worker/semantic_matching_evaluator.py

# 指定数据文件和输出目录
python src/runner_worker/semantic_matching_evaluator.py --data-path data/my_experiment.csv --output-dir results/
```

## 输出文件

脚本会生成以下输出文件：

1. `roc_curves.png`: 所有模型的ROC曲线图
2. `pr_curves.png`: 所有模型的精确率-召回率曲线图
3. `evaluation_results.csv`: 包含所有模型评估指标的CSV文件
4. `{model_name}_threshold_sensitivity.csv`: 每个模型的阈值敏感性分析数据
5. `{model_name}_threshold_sensitivity.png`: 每个模型的阈值敏感性分析图表

## 评估指标解释

### ROC曲线和AUC

ROC（接收者操作特征）曲线是通过绘制不同阈值下的真正例率（TPR）和假正例率（FPR）得到的。曲线下面积（AUC）是模型区分正负样本能力的度量，值越接近1表示模型性能越好。

### 最佳阈值

最佳阈值是通过最大化Youden's J统计量（J = TPR - FPR）确定的，它代表了在平衡敏感性和特异性方面的最佳决策点。

### 精确率-召回率曲线

PR曲线显示了不同阈值下精确率和召回率之间的权衡。平均精确率（AP）是PR曲线下的面积，是另一个评估模型性能的重要指标。

### 阈值敏感性分析

阈值敏感性分析展示了不同阈值值对模型性能指标的影响，包括：
- 准确率（Accuracy）: 正确预测的样本比例
- 精确率（Precision）: 预测为正的样本中实际为正的比例
- 召回率/敏感性（Recall/Sensitivity）: 实际为正的样本中被正确预测为正的比例
- 特异性（Specificity）: 实际为负的样本中被正确预测为负的比例
- F1分数（F1 Score）: 精确率和召回率的调和平均数

通过阈值敏感性分析，可以根据具体应用场景的需求（如更注重精确率还是召回率）选择最合适的阈值。

## 实验结果解读

在本次评估中，我们比较了三种语义匹配模型：

1. **Word2Vec**: 基于词向量的简单模型
2. **BGE-Large**: 大型预训练语言模型
3. **BGE-M3**: 多语言多模态预训练模型

评估结果显示：

- **BGE-M3** 模型表现最佳，AUC为0.9600，最佳阈值为0.8863，使用该阈值时准确率为0.8936
- **BGE-Large** 模型表现次之，AUC为0.9529，最佳阈值为0.8151，使用该阈值时准确率为0.8802
- **Word2Vec** 模型表现最差，AUC仅为0.6465，最佳阈值为0.3933，使用该阈值时准确率为0.5974

这表明预训练语言模型（BGE-Large和BGE-M3）在语义匹配任务上显著优于传统的词向量模型（Word2Vec）。特别是BGE-M3模型，其性能指标在所有方面都略优于BGE-Large模型。

## 阈值选择建议

根据阈值敏感性分析，我们可以针对不同的应用场景提供以下建议：

1. **平衡场景**（同时关注准确率和召回率）：使用Youden's J统计量确定的最佳阈值
   - BGE-M3: 0.8863
   - BGE-Large: 0.8151
   - Word2Vec: 0.3933

2. **高精确率场景**（更关注减少假正例）：选择较高的阈值
   - BGE-M3: 0.90-0.95
   - BGE-Large: 0.85-0.90
   - Word2Vec: 0.45-0.50

3. **高召回率场景**（更关注减少假负例）：选择较低的阈值
   - BGE-M3: 0.80-0.85
   - BGE-Large: 0.75-0.80
   - Word2Vec: 0.30-0.35

请参考阈值敏感性分析图表和数据，根据具体应用需求选择最合适的阈值。

## 应用建议

基于评估结果，我们建议：

1. 在生产环境中优先使用BGE-M3模型进行语义匹配任务
2. 使用评估得出的最佳阈值（0.8863）作为判断两个句子是否语义相似的决策阈值
3. 如果计算资源有限，BGE-Large模型也是一个不错的选择，其性能仅略低于BGE-M3
4. 根据具体应用场景的需求，参考阈值敏感性分析结果调整阈值

## 注意事项

- 评估结果基于特定数据集，在应用到其他场景时可能需要重新评估和调整阈值
- 模型性能可能受到数据质量、领域特性等因素的影响
- 在实际应用中，除了AUC和准确率外，还应考虑模型的推理速度、资源消耗等因素
